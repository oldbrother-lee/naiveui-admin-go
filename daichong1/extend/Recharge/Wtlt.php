<?php
/*
 本代码由 成都大猿人网络科技有限公司 原创开发
 官方网址：www.dayuanren.cn
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace Recharge;use app\common\model\Porder as PorderModel;class Wtlt{private $mchid;private $apikey;private $notify;private $apiUrl;public function __construct($option){if(isset($option['param1']))goto TekeWjgx2;goto TekldMhx2;TekeWjgx2:$TekJQ=$option['param1'];goto Tekx1;TekldMhx2:$TekJQ='';Tekx1:unset($TektIJR);$TektIJR=$TekJQ;$this->mchid=$TektIJR;if(isset($option['param2']))goto TekeWjgx4;goto TekldMhx4;TekeWjgx4:$TekJQ=$option['param2'];goto Tekx3;TekldMhx4:$TekJQ='';Tekx3:unset($TektIJR);$TektIJR=$TekJQ;$this->apikey=$TektIJR;if(isset($option['param3']))goto TekeWjgx6;goto TekldMhx6;TekeWjgx6:$TekJQ=$option['param3'];goto Tekx5;TekldMhx6:$TekJQ='';Tekx5:unset($TektIJR);$TektIJR=$TekJQ;$this->notify=$TektIJR;if(isset($option['param4']))goto TekeWjgx8;goto TekldMhx8;TekeWjgx8:$TekJQ=$option['param4'];goto Tekx7;TekldMhx8:$TekJQ='';Tekx7:unset($TektIJR);$TektIJR=$TekJQ;$this->apiUrl=$TektIJR;}public function recharge($out_trade_num,$mobile,$param,$isp=''){unset($TektIJQ);$TektIJQ="md5";$GLOBALS["A__A_A"]=$TektIJQ;unset($TektIJQ);$TektIJQ=$this->get_teltype($isp);$A____A=$TektIJQ;unset($TektIJQ);$TektIJQ=$param['param1'];$A___A_=$TektIJQ;$TekJQ=$this->mchid . $out_trade_num;$TekJR=$TekJQ . $mobile;$TekJS=$TekJR . $A___A_;$TekJT=$TekJS . $A____A;$TekJU=$TekJT . $this->notify;$TekJV=$TekJU . $this->apikey;unset($TektIJW);$TektIJW=$TekJV;$A___AA=$TektIJW;unset($TektIJQ);$TektIJQ=$GLOBALS["A__A_A"](urldecode($A___AA));$A__A__=$TektIJQ;return $this->http_post($this->apiUrl,["partner_id"=>$this->mchid,"phone"=>$mobile,"partner_order_no"=>$out_trade_num,"amount"=>$A___A_,"type"=>$A____A,'notify_url'=>$this->notify,'sign'=>$A__A__]);}private function get_teltype($str){switch($str){case '移动':return 2;case '联通':return 1;case '电信':return 3;default:return -1;}}private function http_post($url,$param){unset($TektIJQ);$TektIJQ="stripos";$GLOBALS["A_A_AA"]=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_init();$A__AA_=$TektIJQ;$TekJQ=$GLOBALS["A_A_AA"]($url,"https://")!==FALSE;if($TekJQ)goto TekeWjgxf;goto TekldMhxf;TekeWjgxf:curl_setopt($A__AA_,CURLOPT_SSL_VERIFYPEER,FALSE);curl_setopt($A__AA_,CURLOPT_SSL_VERIFYHOST,false);curl_setopt($A__AA_,CURLOPT_SSLVERSION,1);goto Tekxe;TekldMhxf:Tekxe:if(is_string($param))goto TekeWjgxh;goto TekldMhxh;TekeWjgxh:unset($TektIJQ);$TektIJQ=$param;$A__AAA=$TektIJQ;goto Tekxg;TekldMhxh:unset($TektIJQ);$TektIJQ=http_build_query($param);$A__AAA=$TektIJQ;Tekxg:curl_setopt($A__AA_,CURLOPT_URL,$url);curl_setopt($A__AA_,CURLOPT_RETURNTRANSFER,1);curl_setopt($A__AA_,CURLOPT_POST,true);curl_setopt($A__AA_,CURLOPT_CONNECTTIMEOUT,30);curl_setopt($A__AA_,CURLOPT_TIMEOUT,90);curl_setopt($A__AA_,CURLOPT_POSTFIELDS,$A__AAA);curl_setopt($A__AA_,CURLOPT_HEADER,0);unset($TektIJQ);$TektIJQ=curl_exec($A__AA_);$A_A___=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_getinfo($A__AA_);$A_A__A=$TektIJQ;curl_close($A__AA_);$TekJQ=intval($A_A__A["http_code"])==200;if($TekJQ)goto TekeWjgxj;goto TekldMhxj;TekeWjgxj:unset($TektIJQ);$TektIJQ=json_decode($A_A___,true);$A_A_A_=$TektIJQ;$TekJQ=$A_A_A_['code']==1;if($TekJQ)goto TekeWjgxl;goto TekldMhxl;TekeWjgxl:return rjson(0,$A_A_A_['msg'],$A_A_A_);goto Tekxk;TekldMhxl:return rjson(1,$A_A_A_['msg'],$A_A_A_);Tekxk:goto Tekxi;TekldMhxj:$TekvPJQ='接口访问失败，http错误码' . $A_A__A["http_code"];return rjson(500,$TekvPJQ);Tekxi:}private function http_id($url,$cookies){unset($TektIJQ);$TektIJQ="stripos";$GLOBALS["AA____"]=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_init();$A_AA__=$TektIJQ;$TekJQ=$GLOBALS["AA____"]($url,"https://")!==FALSE;if($TekJQ)goto TekeWjgxn;goto TekldMhxn;TekeWjgxn:curl_setopt($A_AA__,CURLOPT_SSL_VERIFYPEER,FALSE);curl_setopt($A_AA__,CURLOPT_SSL_VERIFYHOST,false);curl_setopt($A_AA__,CURLOPT_SSLVERSION,1);goto Tekxm;TekldMhxn:Tekxm:curl_setopt($A_AA__,CURLOPT_URL,$url);curl_setopt($A_AA__,CURLOPT_RETURNTRANSFER,1);curl_setopt($A_AA__,CURLOPT_CONNECTTIMEOUT,30);curl_setopt($A_AA__,CURLOPT_TIMEOUT,90);curl_setopt($A_AA__,CURLOPT_HEADER,0);curl_setopt($A_AA__,CURLOPT_COOKIE,$cookies);unset($TektIJQ);$TektIJQ=curl_exec($A_AA__);$A_AA_A=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_getinfo($A_AA__);$A_AAA_=$TektIJQ;curl_close($A_AA__);unset($TektIJQ);$TektIJQ=json_decode($A_AA_A,true);$A_AAAA=$TektIJQ;if(isset($A_AAAA["data"][0]['id']))goto TekeWjgxp;goto TekldMhxp;TekeWjgxp:return $A_AAAA["data"][0]['id'];goto Tekxo;TekldMhxp:return 0;Tekxo:}private function http_cookie($url,$param){unset($TektIJQ);$TektIJQ="stripos";$GLOBALS["AA_AAA"]=$TektIJQ;unset($TektIJQ);$TektIJQ="preg_match";$GLOBALS["AAA___"]=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_init();$AA___A=$TektIJQ;$TekJQ=$GLOBALS["AA_AAA"]($url,"https://")!==FALSE;if($TekJQ)goto TekeWjgxr;goto TekldMhxr;TekeWjgxr:curl_setopt($AA___A,CURLOPT_SSL_VERIFYPEER,FALSE);curl_setopt($AA___A,CURLOPT_SSL_VERIFYHOST,false);curl_setopt($AA___A,CURLOPT_SSLVERSION,1);goto Tekxq;TekldMhxr:Tekxq:unset($TektIJQ);$TektIJQ=$param;$AA__A_=$TektIJQ;curl_setopt($AA___A,CURLOPT_URL,$url);curl_setopt($AA___A,CURLOPT_RETURNTRANSFER,1);curl_setopt($AA___A,CURLOPT_POST,true);curl_setopt($AA___A,CURLOPT_CONNECTTIMEOUT,30);curl_setopt($AA___A,CURLOPT_TIMEOUT,90);curl_setopt($AA___A,CURLOPT_POSTFIELDS,$AA__A_);curl_setopt($AA___A,CURLOPT_HEADER,1);unset($TektIJQ);$TektIJQ=curl_exec($AA___A);$AA__AA=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_getinfo($AA___A);$AA_A__=$TektIJQ;curl_close($AA___A);$GLOBALS["AAA___"]('/Cookie:(.*);/iU',$AA__AA,$AA_A_A);unset($TektIJQ);$TektIJQ=$AA_A_A[0];$AA_AA_=$TektIJQ;$TekJQ=intval($AA_A__["http_code"])==200;if($TekJQ)goto TekeWjgxt;goto TekldMhxt;TekeWjgxt:return $AA_AA_;goto Tekxs;TekldMhxt:Tekxs:}private function http_cd($url,$param,$cookies){unset($TektIJQ);$TektIJQ="stripos";$GLOBALS["AAAAA_"]=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_init();$AAA__A=$TektIJQ;$TekJQ=$GLOBALS["AAAAA_"]($url,"https://")!==FALSE;if($TekJQ)goto TekeWjgxv;goto TekldMhxv;TekeWjgxv:curl_setopt($AAA__A,CURLOPT_SSL_VERIFYPEER,FALSE);curl_setopt($AAA__A,CURLOPT_SSL_VERIFYHOST,false);curl_setopt($AAA__A,CURLOPT_SSLVERSION,1);goto Tekxu;TekldMhxv:Tekxu:if(is_string($param))goto TekeWjgxx;goto TekldMhxx;TekeWjgxx:unset($TektIJQ);$TektIJQ=$param;$AAA_A_=$TektIJQ;goto Tekxw;TekldMhxx:unset($TektIJQ);$TektIJQ=http_build_query($param);$AAA_A_=$TektIJQ;Tekxw:curl_setopt($AAA__A,CURLOPT_URL,$url);curl_setopt($AAA__A,CURLOPT_RETURNTRANSFER,1);curl_setopt($AAA__A,CURLOPT_POST,true);curl_setopt($AAA__A,CURLOPT_CONNECTTIMEOUT,30);curl_setopt($AAA__A,CURLOPT_TIMEOUT,90);curl_setopt($AAA__A,CURLOPT_POSTFIELDS,$AAA_A_);curl_setopt($AAA__A,CURLOPT_HEADER,0);curl_setopt($AAA__A,CURLOPT_COOKIE,$cookies);unset($TektIJQ);$TektIJQ=curl_exec($AAA__A);$AAA_AA=$TektIJQ;unset($TektIJQ);$TektIJQ=curl_getinfo($AAA__A);$AAAA__=$TektIJQ;curl_close($AAA__A);$TekJQ=intval($AAAA__["http_code"])==200;if($TekJQ)goto TekeWjgxz;goto TekldMhxz;TekeWjgxz:unset($TektIJQ);$TektIJQ=json_decode($AAA_AA,true);$AAAA_A=$TektIJQ;$TekJQ=$AAAA_A['msg']=='操作成功';if($TekJQ)goto TekeWjgx12;goto TekldMhx12;TekeWjgx12:return rjson(0,$AAAA_A['msg'],$AAAA_A);goto Tekx11;TekldMhx12:return rjson(1,$AAAA_A['msg'],$AAAA_A);Tekx11:goto Tekxy;TekldMhxz:$TekvPJQ='接口访问失败，http错误码' . $AAAA__["http_code"];return rjson(500,$TekvPJQ);Tekxy:}public function selfremove($param){unset($TektIJQ);$TektIJQ="explode";$GLOBALS["A___A_A"]=$TektIJQ;unset($TektIJQ);$TektIJQ="str_replace";$GLOBALS["A___AA_"]=$TektIJQ;unset($TektIJQ);$TektIJQ=M('reapi')->where(['id'=>$param['api_cur_id']])->find();$AAAAAA=$TektIJQ;$TekJQ=new Wtlt($AAAAAA);unset($TektIJR);$TektIJR=$TekJQ;$A______=$TektIJR;$TekJQ=$AAAAAA['param5']!='';if($TekJQ)goto TekeWjgx14;goto TekldMhx14;TekeWjgx14:unset($TektIJQ);$TektIJQ=$GLOBALS["A___A_A"]("|",$AAAAAA['param5']);$A_____A=$TektIJQ;$TekvPvPJQ=$A_____A[0] . '/partner/user/login.html';$TekvPvPJR='userName=' . $A_____A[1];$TekvPvPJS=$TekvPvPJR . '&password=';$TekvPvPJT=$TekvPvPJS . $A_____A[2];unset($TektIJU);$TektIJU=$GLOBALS["A___AA_"]('Cookie: ','',$this->http_cookie($TekvPvPJQ,$TekvPvPJT));$A____A_=$TektIJU;$TekJQ=$A____A_!='';if($TekJQ)goto TekeWjgx16;goto TekldMhx16;TekeWjgx16:$TekvPJQ=$A_____A[0] . '/partner/chargePhone/list.html?page=1&limit=15&partner_order_no=';$TekvPJR=$TekvPJQ . $param['api_order_number'];$TekvPJS=$TekvPJR . '&official_order_no=&phone=&amount=&type=&charge_status=&notify_status=&time=&time_u=';unset($TektIJT);$TektIJT=$this->http_id($TekvPJS,$A____A_);$A____AA=$TektIJT;$TekJQ=$A____AA>0;if($TekJQ)goto TekeWjgx18;goto TekldMhx18;TekeWjgx18:$TekvPJQ=$A_____A[0] . '/partner/chargePhone/cancel.html';$TekvPJR='id=' . $A____AA;unset($TektIJS);$TektIJS=$this->http_cd($TekvPJQ,$TekvPJR,$A____A_);$A___A__=$TektIJS;print_r($A___A__);$TekJQ=$A___A__['errno']==0;if($TekJQ)goto TekeWjgx1a;goto TekldMhx1a;TekeWjgx1a:$TekJQ=$param['api_order_number'] . '-';$TekJR=$TekJQ . $param['mobile'];$TekJS=$TekJR . '-撤单成功</br>';echo $TekJS;goto Tekx19;TekldMhx1a:$TekJQ=$param['api_order_number'] . '-';$TekJR=$TekJQ . $param['mobile'];$TekJS=$TekJR . '-撤单失败，请检查账号密码是否正确！</br>';echo $TekJS;Tekx19:goto Tekx17;TekldMhx18:Tekx17:goto Tekx15;TekldMhx16:Tekx15:goto Tekx13;TekldMhx14:Tekx13:}public function notify(){unset($TektIJQ);$TektIJQ="explode";$GLOBALS["A_A__A_"]=$TektIJQ;unset($TektIJQ);$TektIJQ="str_replace";$GLOBALS["A_A__AA"]=$TektIJQ;if(I('remove'))goto TekeWjgx1c;goto TekldMhx1c;TekeWjgx1c:unset($TektIJQ);$TektIJQ=M('porder p')->join('reapi r','r.id=p.api_cur_id')->where(['r.callapi'=>'Wtlt','p.status'=>3,'apply_refund'=>1])->order('p.pegging_time asc ,p.create_time asc')->limit(100)->field('p.id,p.mobile,p.api_order_number,p.api_trade_num,p.api_cur_param_id,p.api_cur_id')->select();$A___AAA=$TektIJQ;unset($TektIJQ);$TektIJQ=true;$A__A___=$TektIJQ;foreach($A___AAA as $A__A__A=>$A__A_A_){unset($TektIJQ);$TektIJQ=M('reapi')->where(['id'=>$A__A_A_['api_cur_id']])->find();$A__A_AA=$TektIJQ;$TekJQ=new Wtlt($A__A_AA);unset($TektIJR);$TektIJR=$TekJQ;$A__AA__=$TektIJR;unset($TektIJQ);$TektIJQ=true;$A__A___=$TektIJQ;if($TektIJQ)goto TekeWjgx1e;goto TekldMhx1e;TekeWjgx1e:unset($TektIJQ);$TektIJQ=$GLOBALS["A_A__A_"]("|",$A__A_AA['param5']);$A__AA_A=$TektIJQ;$TekvPvPJQ=$A__AA_A[0] . '/partner/user/login.html';$TekvPvPJR='userName=' . $A__AA_A[1];$TekvPvPJS=$TekvPvPJR . '&password=';$TekvPvPJT=$TekvPvPJS . $A__AA_A[2];unset($TektIJU);$TektIJU=$GLOBALS["A_A__AA"]('Cookie: ','',$this->http_cookie($TekvPvPJQ,$TekvPvPJT));$A__AAA_=$TektIJU;goto Tekx1d;TekldMhx1e:Tekx1d:unset($TektIJQ);$TektIJQ=false;$A__A___=$TektIJQ;$TekJQ=$A__AAA_!='';if($TekJQ)goto TekeWjgx1g;goto TekldMhx1g;TekeWjgx1g:$TekvPvPJQ=$A__AA_A[0] . '/partner/chargePhone/list.html?page=1&limit=15&partner_order_no=';$TekvPvPJR=$TekvPvPJQ . $A__A_A_['api_order_number'];$TekvPvPJS=$TekvPvPJR . '&official_order_no=&phone=&amount=&type=&charge_status=&notify_status=&time=&time_u=';unset($TektIJT);$TektIJT=intval($this->http_id($TekvPvPJS,$A__AAA_));$A__AAAA=$TektIJT;$TekJQ=$A__AAAA>0;if($TekJQ)goto TekeWjgx1i;goto TekldMhx1i;TekeWjgx1i:$TekvPJQ=$A__AA_A[0] . '/partner/chargePhone/cancel.html';$TekvPJR='id=' . $A__AAAA;unset($TektIJS);$TektIJS=$this->http_cd($TekvPJQ,$TekvPJR,$A__AAA_);$A_A____=$TektIJS;print_r($A_A____);echo '</br>';$TekJQ=$A_A____['code']==0;if($TekJQ)goto TekeWjgx1k;goto TekldMhx1k;TekeWjgx1k:$TekJQ=$A__A_A_['api_order_number'] . '-';$TekJR=$TekJQ . $A__A_A_['mobile'];$TekJS=$TekJR . '-撤单成功</br>';echo $TekJS;goto Tekx1j;TekldMhx1k:$TekJQ=$A__A_A_['api_order_number'] . '-';$TekJR=$TekJQ . $A__A_A_['mobile'];$TekJS=$TekJR . '-撤单失败，请检查账号密码是否正确！</br>';echo $TekJS;Tekx1j:goto Tekx1h;TekldMhx1i:Tekx1h:goto Tekx1f;TekldMhx1g:Tekx1f:}goto Tekx1b;TekldMhx1c:unset($TektIJQ);$TektIJQ=intval(I('status'));$A_A___A=$TektIJQ;$TekJQ=$A_A___A==1;if($TekJQ)goto TekeWjgx1m;goto TekldMhx1m;TekeWjgx1m:PorderModel::rechargeSusApi('wtlt',I('partner_order_no'),$_POST,'充值成功',I('official_order_no'));echo "success";goto Tekx1l;TekldMhx1m:$TekJQ=$A_A___A==-1;if($TekJQ)goto TekeWjgx1n;goto TekldMhx1n;TekeWjgx1n:PorderModel::rechargeFailApi('wtlt',I('partner_order_no'),$_POST);echo "success";goto Tekx1l;TekldMhx1n:Tekx1l:Tekx1b:}}
?>